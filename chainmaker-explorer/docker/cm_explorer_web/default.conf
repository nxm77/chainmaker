
    gzip on;
    gzip_http_version  1.1;
    gzip_comp_level    5;
    gzip_min_length    256;
    gzip_proxied	   any;
    gzip_vary          on;
    gzip_types
      application/atom+xml
      application/javascript
      application/json
      application/rss+xml
      application/vnd.ms-fontobject
      application/x-font-ttf
      application/x-web-app-manifest+json
      application/xhtml+xml
      application/xml
      application/octet-stream
      font/opentype
      image/svg+xml
      image/x-icon
      text/css
      text/plain
      text/x-component;
      
server {
    listen 9996;
    http2 on;
    root /usr/share/nginx/html;
    index index.html;
    client_max_body_size 10m;

    # 设置变量，根据cookie判断是否为移动H5版本
    set $root_path "/usr/share/nginx/html";
    if ($http_cookie ~* "is_h5=true") {
        set $root_path "/usr/share/nginx/html/h5";
    }

    gzip on;
    gzip_vary on;
    gzip_types text/plain application/javascript application/x-javascript text/css text/xml application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;

    location / {
        root $root_path;
        try_files $uri $uri/ /index.html;
    }

    location ^~ /assets/ {
        root $root_path;
        try_files /override$uri $uri =404;
        add_header Cache-Control max-age=2592000;
    }

    location ~* \.(css|js|png|jpg|jpeg|gif|gz|svg|mp4|ogg|ogv|webm|htc|xml|woff)$ {
      root $root_path;
      add_header Cache-Control max-age=2592000;
    }

   #浏览器后端服务
    location /chainmaker/ {
        add_header 'Access-Control-Allow-Origin' "$http_origin" always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Allow-Methods' '*' always;
        if ($request_method = 'OPTIONS') {
            return 204;
        }
        proxy_read_timeout 300;
        proxy_pass http://cm_explorer_server:9997/chainmaker;
    }

    #自主查询服务
     location /dquery/sqlQuery {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Allow-Methods' '*' always;
        if ($request_method = 'OPTIONS') {
            return 204;
        }
        proxy_read_timeout 300;
        proxy_pass http://cm_dquery_server:9998/dquery/sqlQuery;
    }
}